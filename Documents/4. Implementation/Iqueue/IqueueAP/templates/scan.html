<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Scannerizza QR Code</title>
</head>

<body>
  <div id="scanner-container"></div>

  <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
  <script>
    var scanner = null; // Inizializza il riferimento al scanner


    function startScanning() {

      var videoElement = document.createElement('video');
      videoElement.id = 'scanner-video';
      document.getElementById('scanner-container').appendChild(videoElement);


      scanner = new Instascan.Scanner({ video: videoElement });

      scanner.addListener('scan', function(content) {

        sendQRCodeValue(content);
      });


      Instascan.Camera.getCameras().then(function(cameras) {
        if (cameras.length > 0) {
          // Avvia il scanner utilizzando la prima fotocamera disponibile
          scanner.start(cameras[0]);
        } else {
          console.error('Nessuna fotocamera trovata');
        }
      });
    }


    function sendQRCodeValue(qrCodeValue) {
      var form = document.createElement('form');
      form.setAttribute('method', 'post');
      form.setAttribute('action', '/ShopOwner/Scan/');

      var csrfToken = document.createElement('input');
      csrfToken.setAttribute('type', 'hidden');
      csrfToken.setAttribute('name', 'csrfmiddlewaretoken');
      csrfToken.setAttribute('value', '{{ csrf_token }}');

      var hiddenField = document.createElement('input');
      hiddenField.setAttribute('type', 'hidden');
      hiddenField.setAttribute('name', 'qrCodeValue');
      hiddenField.setAttribute('value', qrCodeValue);

      form.appendChild(csrfToken);
      form.appendChild(hiddenField);

      document.body.appendChild(form);
      form.submit();
    }


    document.addEventListener('DOMContentLoaded', startScanning);
  </script>
</body>
</html>